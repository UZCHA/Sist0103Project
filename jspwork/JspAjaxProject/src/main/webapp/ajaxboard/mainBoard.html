<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Grandiflora+One&family=Gugi&family=Hahmlet:wght@100..900&family=Hi+Melody&family=Sunflower:wght@300&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<title>Insert title here</title>
<style type="text/css">
	div.list, div.detail,div.updateform{
		position: absolute;
		left: 100px;
		top: 100px;		
		
	}
	div.writeform{
		position: absolute;
		left: 900px;
		top: 100px;		
		
	}
	div.list *,div.writeform, div.detail *,div.updateform *{
		font-family: 'Hahmlet';
		font-size: 12pt;
	}
	span.detail{
		cursor: pointer;
	}
	div.detail button{
		width: 80px;
		margin-right: 10px;
	}
	
</style>
<script type="text/javascript">
	$(function(){
		list();
		
		//입력폼 처음에는 안보이게
		$("div.writeform").hide();
		$("div.updateform").hide();
		//글쓰기 버튼 누르면 보이게
		$("#btnwrite").click(function(){
			$("div.writeform").toggle();
						
		})
		
		$("#btnadd").click(function(){
			var writer=$("#writer").val();
			var subject=$("#subject").val();
			var avata=$("#avata").val();
			var content=$("#content").val();
			//방법1
			//var data="writer="+writer+"&subject="+subject+"&avata="+avata+"&content="+content;
			console.log(writer,subject,avata,content);
			
			
			$.ajax({
				type:"post",
				url:"insertBoard.jsp",
				dataType:"html",
				//data:data,
				//방법2
				data:{"writer":writer,"subject":subject,"avata":avata,"content":content},
				success:function(){
					//alert("dd");
					list();
					//insert성공시 폼 초기화
					$("#writer").val("");
					$("#subject").val("");
					$("#content").val("");
					//입력폼 사라지게
					$("div.writeform").hide();
					
				}
				
			})
		});
			
			//제목 클릭시 내용보기
			$(document).on("click","span.detail",function(){
				//span태그에 넣어둔 num가져온것
				var num=$(this).attr("num");
				//alert(num);
				$.ajax({
					
					type:"get",
					dataType:"json",
					data:{"num":num},
					url:"detailBoard.jsp",
					success:function(data){
						//alert("성공");
						//alert(data.writer);
						var s="<table class='table table-bordered'style='width:500px;'>";
						s+="<caption align='top'><b>디테일 페이지 내용보기</b></caption>"
						s+="<tr class='table-input'>";
						s+="<td><b style='font-size:2em;'>"+data.subject+"</b>";
						s+="<br>작성자:"+data.writer+"<br>";
						s+="<span style='float:right; color:gray;'>"+data.writeday+"</span></td></tr>";
						s+="<tr><td>";
						s+="<img src='"+data.avata+"' align='left' hspace='20'>";					
						s+="<pre>"+data.content+"</pre></td></tr>";
						
						//버튼 두기
						s+="<tr><td align='center'>";
						s+="<button type='button' class='btn btn-success btn-sm btnlist'>목록</button>"
						s+="<button type='button' class='btn btn-info btn-sm btnupdate' num='"+data.num+"'>수정</button>"
						s+="<button type='button' class='btn btn-danger btn-sm btndelete' num='"+data.num+"'>삭제</button>"
						s+="</td></tr>";
						s+="</table>";
						
						$("div.detail").html(s);
						//list숨기고 detail보이게 하기
						$("div.list").hide();
						$("div.detail").show();
					}
				});
			});
			
			//목록버튼 눌렀을때 상세보기 사라지고 목록 나오게하기
			$(document).on("click","button.btnlist",function(){
				$("div.list").show();
				$("div.detail").hide();
			})
			
			//삭제버튼 눌렀을때 상세보기 사라지고 목록 실시간 반영해서 나오게하기
			$(document).on("click","button.btndelete",function(){
				var num=$(this).attr("num");
				//alert(num);
				
				$.ajax({
					type:"get",
					url:"deleteBoard.jsp",
					dataType:"html",
					data:{"num":num},
					success:function(){
						//alert("성공22");
						list();
						$("div.detail").hide();
						$("div.list").show();
					}
					
				})
				
			});
			
			//수정버튼
			$(document).on("click","button.btnupdate",function(){
				var num=$(this).attr("num");
				//alert(num);
				$("#unum").val(num);
				$.ajax({
					
					type:"get",
					url:"detailBoard.jsp",
					dataType:"json",
					data:{"num":num},
					success:function(data){
						//alert("성공");
						$("#unum").val(data.num);
						$("#uwriter").val(data.writer);
						$("#usubject").val(data.subject);
						$("#uavata").val(data.avata);
						$("#ucontent").val(data.content);
						
						$("div.detail").hide();
						$("div.updateform").show();
					}
					
				})
				
				
			});
			
			$("#btnup").click(function(){
				
				//var writer=$("#uwriter").val();
				//var subject=$("#usubject").val();
				//var avata=$("#uavata").val();
				//var content=$("#ucontent").val();
				var data= $("#updatefrm").serialize();		
				
				//alert(data);
				
				//console.log(writer,subject,avata,content);
				
				$.ajax({
					type:"post",
					url:"updateBoard.jsp",
					dataType:"html",
					//data:{"writer":writer,"subject":subject,"content":content,"avata":avata},
					data:data,
					success:function(){
						//alert("수정성공");
						list();
						$("div.list").show();
						$("div.updateform").hide();
						
					}
					
				})
			});
				
	});
	
	////////////////////////////
	function list(){
			//번호 제목 작성자 작성일
			
			 //alert("성공");
		$.ajax({
			
			type:"get",
			dataType:"json",
			url:"listBoard.jsp",			
			success:function(data){
				//alert(data.length);
				var s="<table class='table table-bordered' style='width:700px;'>";
				s+="<caption align='top'><b>게시판 목록</b></caption>";
				s+="<tr class='table-primary'>";
				s+="<th width='80'>번호</th>";
				s+="<th width='350'>제목</th>";
				s+="<th width='180'>작성자</th>";
				s+="<th width='180'>작성일</th>";
				s+="</tr>";
				if(data.length==0){
					s+="<tr>";
					s+="<td colspan='4' align='center'>";
					s+="<b>저장된 글이 없습니다</b>";
					s+="</td></tr>";
				}else{
					//데이타가 1개라도 있는 경우 반복
					$.each(data,function(i,item){
						s+="<tr>";
						s+="<td align='center'>"+(i+1)+"</td>";
						s+="<td>";
						s+="<span num='"+item.num+"' class='detail'>"+item.subject+"</span>";
						s+="</td>";
						s+="<td>"+item.wirter+"</td>";
						s+="<td>"+item.writeday+"</td>";
					})
				}
				
				s+="</table>";
				$("#boardlist").html(s);
			}
			
		});
	}

</script>
</head>
<body>
<div class="list">
	<button type="button" class="btn btn-info" id="btnwrite">글쓰기</button>
	<div id="boardlist">list</div>
</div>

<div class="detail"></div>

<div class="writeform" style="width: 400px;">
	<form action="#">
		<table class="table table-bordered">
			<caption align="top"><b>게시글 추가</b></caption>
			<tr>
				<th class="table-primary">작성자</th>
				<td>
					<input type="text" id="writer" style="width: 120px;"
					class="form-control">
				</td>
			</tr>
			
			<tr>
				<th class="table-primary">제목</th>
				<td>
					<input type="text" id="subject" style="width: 120px;"
					class="form-control">
				</td>
			</tr>
			
			<tr>
				<th class="table-primary">아바타</th>
				<td>
					<select id="avata" class="form-control" style="width: 100px;">
						<option value="../image/avata/b1.png">사랑해</option>
						<option value="../image/avata/b8.png">최고</option>
						<option value="../image/avata/b7.png">신남</option>
						<option value="../image/avata/b6.png">좌절</option>
						<option value="../image/avata/b5.png">배고파</option>
						<option value="../image/avata/b2.png">심심해</option>
					</select>
				</td>
			</tr>
			
			<tr>
				<td colspan="2">
					<textarea style="width: 380px; height: 100px;" id="content"
					class="form-control"></textarea>				
				</td>
			</tr>
			
			<tr>
				<td colspan="2" align="center">
					<button type="button" class="btn btn-danger"
					id="btnadd">DB추가</button>
				</td>
			</tr>
		</table>	
	</form>
</div>

<!-- 수정폼 -->
<div class="updateform" style="width: 400px;">
	<form action="#" id="updatefrm">
	<input type="hidden" id="unum" name="unum" value="">
		<table class="table table-bordered">
			<caption align="top"><b>게시글 수정</b></caption>
			<tr>
				<th class="table-primary">작성자</th>
				<td>
					<input type="text" id="uwriter" name="uwriter" style="width: 120px;"
					class="form-control">
				</td>
			</tr>
			
			<tr>
				<th class="table-primary">제목</th>
				<td>
					<input type="text" id="usubject" name="usubject" style="width: 120px;"
					class="form-control">
				</td>
			</tr>
			
			<tr>
				<th class="table-primary">아바타</th>
				<td>
					<select id="uavata" name="uavata" class="form-control" style="width: 100px;">
						<option value="../image/avata/b1.png">사랑해</option>
						<option value="../image/avata/b8.png">최고</option>
						<option value="../image/avata/b7.png">신남</option>
						<option value="../image/avata/b6.png">좌절</option>
						<option value="../image/avata/b5.png">배고파</option>
						<option value="../image/avata/b2.png">심심해</option>
					</select>
				</td>
			</tr>
			
			<tr>
				<td colspan="2">
					<textarea style="width: 380px; height: 100px;" id="ucontent" name="ucontent"
					class="form-control"></textarea>				
				</td>
			</tr>
			
			<tr>
				<td colspan="2" align="center">
					<button type="button" class="btn btn-danger"
					id="btnup">DB수정</button>
				</td>
			</tr>
		</table>	
	</form>
</div>
</body>
</html>